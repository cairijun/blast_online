function init(){var a,b;if($(".ui.selection.dropdown").dropdown(),tableModal.modal(),textModal.modal(),userGuideModal.modal(),window.localStorage.getItem("task")&&""!==window.localStorage.getItem("task")){for(a=$.parseJSON(window.localStorage.task);a.length>10;)a.shift();for(b=0;b<a.length;b++)paintTask(b)}$("#scrollDiv").scroll(function(){var a=this;cloneTable.css("top",a.scrollTop+"px")}),$("#taskQuery button").click(function(a){a.preventDefault(),addTask_id=$(this).prev().val(),$.getJSON("/status/"+addTask_id).done(addTask).fail(ajaxError)}),$("#btn-inputExample").click(function(){$("#inputText").val(inputExample_text)}),$("div.inputSequences [cached]").each(function(){var a=$(this).attr("cached"),b=window.localStorage.getItem(a)||$(this).val(),c=$(this);("evalue"===a||"database"===a)&&c.val(b).next().text(b)}).change(function(){window.localStorage.setItem($(this).attr("cached"),$(this).val())}).change(),querybtn.click(function(a){return a.preventDefault(),this.className="ui loading button",submitInput(),!1}),$("#btn-clean").click(function(){$("#inputText").val(""),inputFile.val("").change()}),tbody.click(function(a){var b,c,d;_t=a.target,b=$(_t).attr("task-id"),"ui green button"===_t.className?"undefined"!=typeof result[b]?paintTable(b):($(_t).html('<i class="icon loading"></i>'),$.getJSON("/result/"+b).done(function(a){var c;0===a.errno?(c=a.result,"object"==typeof c?(result[b]=c,paintTable(b)):(textModalHead.text("Task_id : "+b).css("color","#119000"),textModalContent.val(a.result),textModal.modal("show"))):(textModalHead.text("Task_id : "+b).css("color","#119000"),textModalContent.val(a.err_mag+a.msg),textModal.modal("show")),$(_t).text("show")}).fail(ajaxError)):"ui red button"===_t.className&&(c=$(_t).attr("num"),d=$.parseJSON(window.localStorage.task),textModalHead.text("Task_id : "+b).css("color","#CD2929"),textModalContent.text(d[c].msg),textModal.modal("show"))}),originTable.click(function(a){var d,e,f,b=a.target,c=tableModalHead.text().slice(10);if("TH"===b.tagName){for(d=0;d<result[c][0].length&&result[c][0][d]!=$(b).text();d++);e=$(b).attr("sort"),f=result[c][0][d],"1"===e?result[c].sort(function(a,b){return a[d]==f?-1:sortFunction(a,b,d,!0)}):result[c].sort(function(a,b){return a[d]==f?-1:sortFunction(a,b,d,!1)}),paintSortTable(c),"1"===e?$(b).attr("sort","0"):$(b).attr("sort","1"),a.stopPropagation()}}),inputFile.change(function(){var a=this;""!==this.value?($("#fileName").html(a.files[0].name+'<i class="icon close"></i>'),$("a.btn_addPic > span").html("change file"),$("#inputText").attr("disabled",!0),inputForm.attr({enctype:"multipart/form-data",action:"/query/upload"}),$("#fileName > i").click(function(){inputFile.val("").change()})):($("#fileName").text(""),$("#inputText").removeAttr("disabled"),$("a.btn_addPic > span").html("<em>+</em>select file"),inputForm.removeAttr("enctype").attr("action","/query"))}),$("#fileName").hover(function(){$(this).find("i").css("visibility","visible")},function(){$(this).find("i").css("visibility","hidden")}),setTimeout(function(){userGuideInit(11,userGuideModal.children(".content"),circleTab),userGuideModal.children("button").click(function(){var a=$(this);"中文"===a.text()?(a.text("English"),c.each(function(){var a=$(this).attr("src");$(this).attr("src",a.slice(0,-7)+"c"+a.slice(-6))})):(a.text("中文"),c.each(function(){var a=$(this).attr("src");$(this).attr("src",a.slice(0,-7)+"e"+a.slice(-6))}))}),$("#btn-userGuide").click(function(){userGuideModal.modal("show")}),userGuideModal.find(".content img").each(function(a){0===a?$(this).addClass("ui transition image visible"):$(this).addClass("ui transition image hidden")});var a=!0,b=circleTab.children(),c=userGuideModal.find(".content img");btnArrowLeft.hide(),userGuideModal.children(".btn-arrow").click(function(d){var e,f;if(a){for(a=!1,btnArrowRight.show(),btnArrowLeft.show(),e=$(d.target),f=0;f<c.length&&!c.eq(f).hasClass("visible");f++);if(e.hasClass("left")){if(1===f&&btnArrowLeft.hide(),0===f)return;c.eq(f).transition("horizontal flip","300ms"),c.eq(f-1).transition("horizontal flip","300ms"),b.eq(f).removeClass("actived"),b.eq(f-1).addClass("actived")}else{if(f===c.length-2&&btnArrowRight.hide(),f===c.length-1)return;c.eq(f).transition("horizontal flip","300ms"),c.eq(f+1).transition("horizontal flip","300ms"),b.eq(f).removeClass("actived"),b.eq(f+1).addClass("actived")}setTimeout(function(){a=!0},300)}}),b.each(function(a){$(this).click(function(){var d=$(this);d.hasClass("actived")||(circleTab.find(".actived").removeClass("actived"),d.addClass("actived"),c.eq(a).transition("horizontal flip","300ms"),c.filter(".visible").transition("horizontal flip","300ms")),0===a?(btnArrowLeft.hide(),btnArrowRight.show()):a===b.length-1?(btnArrowLeft.show(),btnArrowRight.hide()):(btnArrowLeft.show(),btnArrowRight.show())})})},2e3)}function paintSortTable(a){var d,b,c,e,f,g,h;if(result[a]){for(b=originTable.find("tr"),c=result[a][0].length,e=0;e<result[a][0].length;e++)"subject_id"==result[a][0][e]&&(d=e);for(e=1;e<result[a].length;e++)for(f=b.eq(e),g=f.find("td"),h=0;c>h;h++)h===d?g.eq(h).html($("<a>").attr({href:"http://parts.igem.org/Part:"+result[a][e][h],target:"_blank"}).text(result[a][e][h])):g.eq(h).text(result[a][e][h])}}function paintTable(a){var b,c,d,e,f,g,h;if(result[a]){if(originTable.html(""),"query id"===result[a][0][0]){for(c=$("<tr>").appendTo($("<thead>").appendTo(originTable)),d=0;d<result[a][0].length;d++)"subject_id"==result[a][0][d]&&(b=d),$("<th>").text(result[a][0][d]).appendTo(c);cloneTable.html(c.parent().clone())}for(e=$("<tbody>").appendTo(originTable),d=1;d<result[a].length;d++)for(f=$("<tr>").appendTo(e),g=0;g<result[a][d].length;g++)td=g===b?$("<td>").append($("<a>").attr({href:"http://parts.igem.org/Part:"+result[a][d][g],target:"_blank"}).text(result[a][d][g])):$("<td>").text(result[a][d][g]),td.appendTo(f);h=originTable.find("th"),cloneTable.find("th").each(function(a){$(this).click(function(){h.eq(a).click()})}),tableModalHead.text("Task_id : "+a).css("color","#119000"),tableModal.modal("show"),tableFitWidth()}window.onresize=function(){tableModal.hasClass("active")&&tableFitWidth()}}function toNumber(a){var b=parseFloat(a);return b}function sortFunction(a,b,c,d){var e=toNumber(a[c]),f=toNumber(b[c]);return isNaN(e)&&isNaN(f)?d?a[c].localeCompare(b[c]):b[c].localeCompare(a[c]):d?e-f:f-e}function tableFitWidth(){cloneTable.hide(),setTimeout(function(){cloneTable.width(originTable.width());var a=originTable.find("th");cloneTable.find("th").each(function(b){$(this).width(a.eq(b).width())}),cloneTable.show()},1e3)}function finished(a,b){var c=$("<tr>").addClass("positive").append($("<td>").text(a[b].task_id),$("<td>").html('<i class="icon checkmark"></i>'+a[b].status),$("<td>").append($("<button>").attr("task-id",a[b].task_id).addClass("ui green button").text("show")),$("<td>").append($("<a>").attr({href:"/result/download/"+a[b].task_id}).html('<i class="icon download"></i>Download')));return c}function failed(a,b){var c=$("<tr>").addClass("negative").append($("<td>").text(a[b].task_id),$("<td>").html('<i class="icon close"></i>'+a[b].status),$("<td>").append($("<button>").attr({"task-id":a[b].task_id,num:b}).addClass("ui red button").text("information")),$("<td>"));return c}function nonexistent(a,b){var c=$("<tr>").addClass("warning").append($("<td>").text(a[b].task_id),$("<td>").html('<i class="icon question"></i>'+a[b].status),$("<td>").text("Task_id is invalid"),$("<td>"));return c}function waiting(a,b){var c=$("<tr>").append($("<td>").text(a[b].task_id),$("<td>").html('<i class="icon loading"></i>'+a[b].status),$("<td>").html(a[b].msg),$("<td>"));return c}function isEnd(a,b){return"finished"!==a[b].status&&"failed"!==a[b].status&&"nonexistent"!==a[b].status?!1:!0}function longPoll(a,b){$.getJSON("/status/"+a[b].task_id+"/poll").done(function(c){0===c.errno?(a[b].status!==c.status&&(a[b].status=c.status,a[b].err_msg=c.err_msg,a[b].msg=c.msg,window.localStorage.setItem("task",JSON.stringify(a)),change(a,b)),isEnd(a,b)||longPoll(a,b)):(alert(a[b].task_id,c.err_msg),longPoll(a,b))}).fail(ajaxError)}function change(a,b){var c;switch(a[b].status){case"finished":c=finished(a,b);break;case"failed":c=failed(a,b);break;case"nonexistent":c=nonexistent(a,b);break;default:c=waiting(a,b)}tbody.find("tr").eq(a.length-b-1).replaceWith(c)}function ajaxError(){alert("Conection Error")}function submitInput(){$.ajax({url:inputForm.attr("action"),type:"POST",data:new FormData(inputForm[0]),dataType:"json",contentType:!1,processData:!1}).done(addTask).fail(function(){ajaxError()})}function addTask(a){var b,c;a.errno?alert(a.err_msg):(b={task_id:a.task_id||addTask_id,status:a.status||"waiting",err_msg:"",msg:""},window.localStorage.getItem("task")&&""!==window.localStorage.getItem("task")?(c=$.parseJSON(window.localStorage.getItem("task")),c.push(b)):c=[b],window.localStorage.setItem("task",JSON.stringify(c)),paintTask(c.length-1)),querybtn[0].className="ui blue button"}function paintTask(a){var b=$.parseJSON(window.localStorage.task);switch(b[a].status){case"finished":tbody.prepend(finished(b,a));break;case"failed":tbody.prepend(failed(b,a));break;case"nonexistent":tbody.prepend(nonexistent(b,a));break;default:tbody.prepend(waiting(b,a)),longPoll(b,a)}}function userGuideInit(a,b,c){var d,e;for(d=1;a>=d;d++)e=10>d?"0"+d:d,$("<img>").attr("src","/static/images/user_guide/e"+e+".jpg").appendTo(b),1===d?$("<i>").addClass("circle icon actived").appendTo(c):$("<i>").addClass("circle icon").appendTo(c);for(c.css("margin-left",-28*a/2+"px"),d=1;a>=d;d++)e=10>d?"0"+d:d,$.get("/static/images/user_guide/c"+e+".jpg")}var tbody=$("#resultTbody"),inputForm=$("form#userInput"),querybtn=$("#btn-query"),tableModal=$("#tableModal"),tableModalHead=$("#tableModal .header"),textModal=$("#textModal"),textModalHead=$("#textModal .header"),textModalContent=$("#textModal textarea"),originTable=$("#originTable"),userGuideModal=$("#userGuideModal"),btnArrowLeft=userGuideModal.find(".btn-arrow.left"),btnArrowRight=userGuideModal.find(".btn-arrow.right"),inputExample_text=$("#inputExample-txt").contents().find("pre").text(),inputFile=$("input.filePrew"),cloneTable=$("#cloneTable"),circleTab=userGuideModal.children(".circleTab"),result=new Object,addTask_id,resizeTimeTask;$(init);